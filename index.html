<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MIDCARE© System Dynamics – Success to the Successful</title>
  <style>
    :root {
      --bg: #ffffff;
      --card: #f8fafc;
      --ink: #111111;
      --muted: #555555;
      --accent-navy: #1e3a8a;
      --accent-teal: #0d9488;
      --accent-blue: #2563eb;
      --border: #e5e7eb;
      --radius: 10px;
    }
    html, body {
      background: var(--bg);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      margin: 0; padding: 0;
    }
    .container {
      max-width: 1300px;
      margin: 16px auto 40px;
      padding: 0 12px;
    }
    .title-row {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }
    .title-logo {
      height: 46px;
      width: auto;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 4px;
      color: var(--accent-navy);
    }
    .subtitle {
      font-size: 13px;
      color: var(--muted);
      max-width: 780px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 10px;
      margin-top: 10px;
      box-shadow: 0 2px 6px rgba(15,23,42,0.04);
    }
    .controls-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    @media (max-width: 960px) {
      .controls-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 640px) {
      .controls-grid { grid-template-columns: 1fr; }
    }
    .control {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 6px 9px;
      font-size: 12px;
    }
    .control-label {
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 4px;
      color: var(--accent-navy);
    }
    .control-value {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }
    input[type=range] {
      width: 100%;
    }
    .button-bar {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .button-bar button {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--accent-navy);
      background: #e0ecff;
      font-size: 12px;
      cursor: pointer;
    }
    .button-bar button#resetBtn {
      border-color: #94a3b8;
      background: #f1f5f9;
    }
    .button-bar button:hover {
      filter: brightness(0.97);
    }
    .run-help {
      font-size: 11px;
      color: var(--muted);
    }
    .charts-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 960px) {
      .charts-3 { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 780px) {
      .charts-3 { grid-template-columns: 1fr; }
    }
    .panel-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--accent-navy);
    }
    canvas {
      max-height: 150px;
    }
    .table-wrapper {
      margin-top: 14px;
    }
    .table-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--accent-navy);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11.5px;
    }
    thead {
      background: #e5f0ff;
    }
    th, td {
      border: 1px solid var(--border);
      padding: 4px 6px;
      text-align: center;
    }
    th {
      font-weight: 600;
      color: var(--accent-navy);
    }
    .table-note {
      margin-top: 6px;
      font-size: 10.5px;
      color: var(--muted);
    }
    a.source-link {
      color: #1e3a8a;
      text-decoration: underline;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
</head>
<body>
<div class="container">

  <div class="title-row">
    <!-- Logo loaded from the same online source as your example -->
    <img
      class="title-logo"
      src="https://assets.zyrosite.com/AoP61N2BR4i8Q6jl/logo-hsml-AE07eKDgMLFgWBoQ.png"
      alt="HSML Logo"
    />
    <div>
      <h1>MIDCARE© System Dynamic Adapted Success to the Successful Archetype – Private Health Insurance versus Public Health Coverage</h1>
      <div class="subtitle">
        Press run button to extend the historical series (2008–2024) with model projections from 2025 to the selected final year.
      </div>
    </div>
  </div>

  <div class="card">
    <div class="controls-grid">
      <div class="control">
        <div class="control-label">Resources (percent / year)</div>
        <input id="resourcesSlider" type="range" min="0" max="2" step="0.01" value="1" />
        <div class="control-value">Current: <span id="resourcesValue">1.00</span></div>
      </div>

      <div class="control">
        <div class="control-label">Normal loss – private (1 / year)</div>
        <input id="lossPrivSlider" type="range" min="0" max="0.05" step="0.001" value="0.014" />
        <div class="control-value">Current: <span id="lossPrivValue">0.014</span></div>
      </div>

      <div class="control">
        <div class="control-label">Normal loss – public (1 / year)</div>
        <input id="lossPubSlider" type="range" min="0" max="0.05" step="0.001" value="0.024" />
        <div class="control-value">Current: <span id="lossPubValue">0.024</span></div>
      </div>

      <div class="control">
        <div class="control-label">Initial private coverage (for alternative runs, %)</div>
        <input id="initPrivSlider" type="range" min="0" max="100" step="0.1" value="46.2" />
        <div class="control-value">Display only (history fixed): <span id="initPrivValue">46.2</span></div>
      </div>

      <div class="control">
        <div class="control-label">Initial public coverage (for alternative runs, %)</div>
        <input id="initPubSlider" type="range" min="0" max="100" step="0.1" value="37.6" />
        <div class="control-value">Display only (history fixed): <span id="initPubValue">37.6</span></div>
      </div>

      <div class="control">
        <div class="control-label">Final simulation year</div>
        <input id="finalTimeSlider" type="range" min="2025" max="2050" step="1" value="2050" />
        <div class="control-value">Simulates to <span id="finalTimeValue">2050</span></div>
      </div>
    </div>

    <div class="button-bar">
      <button id="runBtn">Run from 2025</button>
      <button id="resetBtn">Reset</button>
      <div class="run-help">Projection grows year-by-year from the 2024 endpoint; no vertical jump from the bottom of the graph.</div>
    </div>
  </div>

  <div class="charts-3">
    <div class="card">
      <div class="panel-title">Private vs public coverage (%)</div>
      <canvas id="coverageChart"></canvas>
    </div>
    <div class="card">
      <div class="panel-title">Success ratio (PHI share of total coverage)</div>
      <canvas id="ratioChart"></canvas>
    </div>
    <div class="card">
      <div class="panel-title">Allocation table vs success ratio</div>
      <canvas id="allocationChart"></canvas>
    </div>
  </div>

  <div class="card table-wrapper">
    <div class="table-title">Historical Coverage – Table A1</div>
    <table>
      <thead>
        <tr>
          <th>Year</th>
          <th>PHI coverage (%)</th>
          <th>Medical Card coverage (%)</th>
          <th>Difference, Δ (percentage points)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>2008</td><td>46.2</td><td>37.6</td><td>8.6</td></tr>
        <tr><td>2009</td><td>46.2</td><td>37.6</td><td>8.6</td></tr>
        <tr><td>2010</td><td>46.2</td><td>37.6</td><td>8.6</td></tr>
        <tr><td>2011</td><td>46.2</td><td>37.6</td><td>8.6</td></tr>
        <tr><td>2012</td><td>46.2</td><td>41.3</td><td>4.9</td></tr>
        <tr><td>2013</td><td>43.7</td><td>40.6</td><td>3.1</td></tr>
        <tr><td>2014</td><td>41.7</td><td>38.1</td><td>3.6</td></tr>
        <tr><td>2015</td><td>42.1</td><td>36.8</td><td>5.3</td></tr>
        <tr><td>2016</td><td>42.4</td><td>34.9</td><td>7.5</td></tr>
        <tr><td>2017</td><td>43.5</td><td>31.8</td><td>11.7</td></tr>
        <tr><td>2018</td><td>45.2</td><td>33.3</td><td>11.9</td></tr>
        <tr><td>2019</td><td>45.7</td><td>30.7</td><td>15.0</td></tr>
        <tr><td>2020</td><td>46.1</td><td>30.9</td><td>15.2</td></tr>
        <tr><td>2021</td><td>46.7</td><td>30.7</td><td>16.0</td></tr>
        <tr><td>2022</td><td>47.2</td><td>30.3</td><td>16.9</td></tr>
        <tr><td>2023</td><td>47.0</td><td>30.5</td><td>16.5</td></tr>
        <tr><td>2024</td><td>46.0</td><td>29.0</td><td>17.0</td></tr>
      </tbody>
    </table>
    <div class="table-note">
      Table A1. Historical coverage series used to calibrate the Vensim model (Ireland, 2008–2024). Difference is computed as Δ = PHI − Medical Card (percentage points).<br><br>
      <strong>Sources:</strong><br>
      1] Health Insurance Authority: <em>Health Insurance in Ireland: Market Report 2024</em>.<br>
      <a class="source-link" href="https://www.hia.ie/publication/market-reports/market-report-2024" target="_blank">
        https://www.hia.ie/publication/market-reports/market-report-2024
      </a> (accessed 14 December 2025) (2025).<br><br>
      2] DoI: Minister for Health publishes <em>Health in Ireland: Key Trends 2024</em>.<br>
      <a class="source-link" href="https://www.gov.ie/en/department-of-health/press-releases/minister-for-health-publishes-health-in-ireland-key-trends-2024/" target="_blank">
        https://www.gov.ie/en/department-of-health/press-releases/minister-for-health-publishes-health-in-ireland-key-trends-2024/
      </a> (2024).
    </div>
  </div>

</div>

<script>
const INITIAL_TIME = 2008;
const TIME_STEP = 1;
const HIST_END_YEAR = 2024;
const BASELINE_FINAL_YEAR = 2050;

// Historical series (2008–2024)
const histYears = [
  2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024
];
const histPriv = [
  46.2,46.2,46.2,46.2,46.2,43.7,41.7,42.1,42.4,43.5,45.2,45.7,46.1,46.7,47.2,47.0,46.0
];
const histPub = [
  37.6,37.6,37.6,37.6,41.3,40.6,38.1,36.8,34.9,31.8,33.3,30.7,30.9,30.7,30.3,30.5,29.0
];

// Build lookup maps
const histPrivMap = {};
const histPubMap  = {};
histYears.forEach((y, i) => {
  histPrivMap[y] = histPriv[i];
  histPubMap[y]  = histPub[i];
});

// Global year grid
let allYears = [];
for (let y = INITIAL_TIME; y <= BASELINE_FINAL_YEAR; y += TIME_STEP) {
  allYears.push(y);
}

// Allocation lookup points
const allocPts = [
  {x:0, y:0},
  {x:0.1, y:0.05},
  {x:0.2, y:0.10},
  {x:0.3, y:0.20},
  {x:0.4, y:0.30},
  {x:0.45, y:0.40},
  {x:0.5, y:0.50},
  {x:0.55, y:0.60},
  {x:0.6, y:0.70},
  {x:0.65, y:0.85},
  {x:0.7, y:0.90},
  {x:0.8, y:0.95},
  {x:0.9, y:1.00},
  {x:1.0, y:1.00}
];

function lookupAlloc(x) {
  if (x <= 0) return 0;
  if (x >= 1) return 1;
  for (let i = 0; i < allocPts.length - 1; i++) {
    const a = allocPts[i], b = allocPts[i+1];
    if (x >= a.x && x <= b.x) {
      const f = (x - a.x) / (b.x - a.x);
      return a.y + f * (b.y - a.y);
    }
  }
  return 0;
}

// Forward run from startYear to finalYear using stocks at startYear
function runForward(params) {
  let priv = params.initPriv;
  let pub  = params.initPub;
  const t = [], ps = [], qs = [], rs = [];
  for (let year = params.startYear + TIME_STEP; year <= params.finalYear; year += TIME_STEP) {
    const total = priv + pub;
    const ratio = total > 0 ? priv / total : 0;
    const alloc = lookupAlloc(ratio);
    const gainPriv = params.res * alloc;
    const gainPub  = params.res * (1 - alloc);
    const lossPriv = priv * params.lossPriv;
    const lossPub  = pub * params.lossPub;
    priv = priv + (gainPriv - lossPriv);
    pub  = pub  + (gainPub  - lossPub);
    t.push(year);
    ps.push(priv);
    qs.push(pub);
    rs.push(ratio);
  }
  return { t, ps, qs, rs };
}

let coverageChart, ratioChart, allocationChart;
let animationInterval = null;

function initCharts() {
  const coverageCtx = document.getElementById('coverageChart').getContext('2d');
  const ratioCtx    = document.getElementById('ratioChart').getContext('2d');
  const allocCtx    = document.getElementById('allocationChart').getContext('2d');

  const privData = allYears.map(y =>
    y <= HIST_END_YEAR && histPrivMap[y] !== undefined ? histPrivMap[y] : null
  );
  const pubData  = allYears.map(y =>
    y <= HIST_END_YEAR && histPubMap[y]  !== undefined ? histPubMap[y]  : null
  );
  const ratioData= allYears.map(y => {
    if (y <= HIST_END_YEAR && histPrivMap[y] !== undefined && histPubMap[y] !== undefined) {
      const tot = histPrivMap[y] + histPubMap[y];
      return tot > 0 ? histPrivMap[y] / tot : null;
    }
    return null;
  });

  coverageChart = new Chart(coverageCtx, {
    type: 'line',
    data: {
      labels: allYears,
      datasets: [
        {
          label: 'Private coverage (%)',
          data: privData,
          borderWidth: 2,
          borderColor: '#1e3a8a',
          pointRadius: 0,
          spanGaps: false,
          fill: false
        },
        {
          label: 'Public coverage (%)',
          data: pubData,
          borderWidth: 2,
          borderColor: '#0d9488',
          borderDash: [4, 2],
          pointRadius: 0,
          spanGaps: false,
          fill: false
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      plugins: { legend: { labels: { boxWidth: 10, font: { size: 10 } } } },
      scales: {
        y: { min: 0, max: 100, grid: { display: false }, ticks: { font: { size: 9 } } },
        x: { grid: { display: false }, ticks: { font: { size: 9 } } }
      }
    }
  });

  ratioChart = new Chart(ratioCtx, {
    type: 'line',
    data: {
      labels: allYears,
      datasets: [
        {
          label: 'Success ratio (PHI / total)',
          data: ratioData,
          borderWidth: 2,
          borderColor: '#2563eb',
          pointRadius: 0,
          spanGaps: false,
          fill: false
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      plugins: { legend: { labels: { boxWidth: 10, font: { size: 10 } } } },
      scales: {
        y: { min: 0, max: 1, grid: { display: false }, ticks: { font: { size: 9 } } },
        x: { grid: { display: false }, ticks: { font: { size: 9 } } }
      }
    }
  });

  // Allocation lookup curve (static only)
  const xs = [], ys = [];
  for (let i = 0; i <= 100; i++) { xs.push(i/100); ys.push(lookupAlloc(i/100)); }
  allocationChart = new Chart(allocCtx, {
    type: 'line',
    data: {
      labels: xs,
      datasets: [
        {
          label: 'Allocation to private (lookup)',
          data: ys,
          borderWidth: 2,
          borderColor: '#0f766e',
          pointRadius: 0,
          fill: false
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      plugins: { legend: { labels: { boxWidth: 10, font: { size: 10 } } } },
      scales: {
        y: { min: 0, max: 1, grid: { display: false }, ticks: { font: { size: 9 } } },
        x: { min: 0, max: 1, grid: { display: false }, ticks: { font: { size: 9 } } }
      }
    }
  });
}

// Update numeric labels for sliders
function updateValueLabels() {
  const res = parseFloat(resourcesSlider.value);
  const lossPriv = parseFloat(lossPrivSlider.value);
  const lossPub  = parseFloat(lossPubSlider.value);
  const initPriv = parseFloat(initPrivSlider.value);
  const initPub  = parseFloat(initPubSlider.value);
  const finalYear = parseInt(finalTimeSlider.value, 10);

  resourcesValue.textContent = res.toFixed(2);
  lossPrivValue.textContent = lossPriv.toFixed(3);
  lossPubValue.textContent  = lossPub.toFixed(3);
  initPrivValue.textContent = initPriv.toFixed(1);
  initPubValue.textContent  = initPub.toFixed(1);
  finalTimeValue.textContent = finalYear;
}

// Run button: extend from 2025 to selected final year with left-to-right growth
function runScenarioFrom2025() {
  const finalYear = parseInt(finalTimeSlider.value, 10);

  if (animationInterval !== null) {
    clearInterval(animationInterval);
    animationInterval = null;
  }

  const params = {
    res: parseFloat(resourcesSlider.value),
    lossPriv: parseFloat(lossPrivSlider.value),
    lossPub: parseFloat(lossPubSlider.value),
    initPriv: histPrivMap[HIST_END_YEAR],
    initPub: histPubMap[HIST_END_YEAR],
    startYear: HIST_END_YEAR,
    finalYear: finalYear
  };
  const sim = runForward(params);

  if (sim.t.length === 0) {
    return;
  }

  const privData = allYears.map(y =>
    y <= HIST_END_YEAR && histPrivMap[y] !== undefined ? histPrivMap[y] : null
  );
  const pubData  = allYears.map(y =>
    y <= HIST_END_YEAR && histPubMap[y]  !== undefined ? histPubMap[y]  : null
  );
  const ratioData= allYears.map(y => {
    if (y <= HIST_END_YEAR && histPrivMap[y] !== undefined && histPubMap[y] !== undefined) {
      const tot = histPrivMap[y] + histPubMap[y];
      return tot > 0 ? histPrivMap[y] / tot : null;
    }
    return null;
  });

  // Seed the first projected point (e.g. 2025) immediately so the line continues from 2024
  const firstYear = sim.t[0];
  const firstIdx = allYears.indexOf(firstYear);
  if (firstIdx !== -1) {
    privData[firstIdx] = sim.ps[0];
    pubData[firstIdx]  = sim.qs[0];
    ratioData[firstIdx]= sim.rs[0];
  }

  coverageChart.data.datasets[0].data = privData;
  coverageChart.data.datasets[1].data = pubData;
  ratioChart.data.datasets[0].data    = ratioData;
  coverageChart.update('none');
  ratioChart.update('none');

  // Animate the remaining years left-to-right
  let stepIndex = 1;
  animationInterval = setInterval(() => {
    if (stepIndex >= sim.t.length) {
      clearInterval(animationInterval);
      animationInterval = null;
      return;
    }
    const year = sim.t[stepIndex];
    const idx = allYears.indexOf(year);
    if (idx !== -1) {
      privData[idx] = sim.ps[stepIndex];
      pubData[idx]  = sim.qs[stepIndex];
      ratioData[idx]= sim.rs[stepIndex];
      coverageChart.update('none');
      ratioChart.update('none');
    }
    stepIndex += 1;
  }, 200); // 0.2 seconds per step
}

// Reset button: historical-only view (to 2024) and clear projections/animation
function resetDashboard() {
  if (animationInterval !== null) {
    clearInterval(animationInterval);
    animationInterval = null;
  }

  resourcesSlider.value = 1.0;
  lossPrivSlider.value = 0.014;
  lossPubSlider.value  = 0.024;
  initPrivSlider.value = 46.2;
  initPubSlider.value  = 37.6;
  finalTimeSlider.value = BASELINE_FINAL_YEAR;
  updateValueLabels();

  const privData = allYears.map(y =>
    y <= HIST_END_YEAR && histPrivMap[y] !== undefined ? histPrivMap[y] : null
  );
  const pubData  = allYears.map(y =>
    y <= HIST_END_YEAR && histPubMap[y]  !== undefined ? histPubMap[y]  : null
  );
  const ratioData= allYears.map(y => {
    if (y <= HIST_END_YEAR && histPrivMap[y] !== undefined && histPubMap[y] !== undefined) {
      const tot = histPrivMap[y] + histPubMap[y];
      return tot > 0 ? histPrivMap[y] / tot : null;
    }
    return null;
  });

  coverageChart.data.datasets[0].data = privData;
  coverageChart.data.datasets[1].data = pubData;
  coverageChart.update('none');

  ratioChart.data.datasets[0].data = ratioData;
  ratioChart.update('none');
}

window.addEventListener('load', () => {
  initCharts();
  updateValueLabels();

  ['resourcesSlider','lossPrivSlider','lossPubSlider','initPrivSlider','initPubSlider','finalTimeSlider']
    .forEach(id => document.getElementById(id).addEventListener('input', updateValueLabels));

  document.getElementById('runBtn').addEventListener('click', runScenarioFrom2025);
  document.getElementById('resetBtn').addEventListener('click', resetDashboard);
});
</script>
</body>
</html>

